<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Set file immutable | Zeebe Chaos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2021/03/30/set-file-immutable"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Set file immutable | Zeebe Chaos"><meta data-rh="true" name="description" content="This chaos day was a bit different. Actually I wanted to experiment again with camunda cloud and verify that our high load chaos experiments are now working with the newest cluster plans, see zeebe-cluster-testbench#135."><meta data-rh="true" property="og:description" content="This chaos day was a bit different. Actually I wanted to experiment again with camunda cloud and verify that our high load chaos experiments are now working with the newest cluster plans, see zeebe-cluster-testbench#135."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-03-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/zelldon"><link data-rh="true" rel="icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-rh="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2021/03/30/set-file-immutable"><link data-rh="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/03/30/set-file-immutable" hreflang="en"><link data-rh="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/03/30/set-file-immutable" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Atom Feed"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.5489edc0.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.cf57c9dd.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.b7fadd9c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><div class="navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/06/02/Using-Large-Multi-Instance">Using Large Multi-Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/05/19/Continuing-SST-Partitioning-toggle">Continuing SST Partitioning toggle</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/05/15/SST-Partitioning-toggle">SST Partitioning toggle</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/04/06/gateway-termination">Gateway Termination</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2023/02/23/Recursive-call-activity">Recursive call activity</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition">Message Correlation after Network Partition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/08/02/deployment-distribution">Bring Deployment distribution experiment back</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency">High Snapshot Frequency</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2022/01/19/big-variables">Handling of Big Variables</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Set file immutable</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-03-30T00:00:00.000Z" itemprop="datePublished">March 30, 2021</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>This chaos day was a bit different. Actually I wanted to experiment again with camunda cloud and verify that our high load chaos experiments are now working with the newest cluster plans, see <a href="https://github.com/zeebe-io/zeebe-cluster-testbench/issues/135" target="_blank" rel="noopener noreferrer">zeebe-cluster-testbench#135</a>.
Unfortunately I found out that our test chaos cluster was in a way broken, that we were not able to create new clusters. Luckily this was fixed at the end of the day, thanks to @immi :) </p><p>Because of these circumstances I thought about different things to experiment with, and I remembered that in the <a href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">last chaos day</a> we worked with patching running deployments, in order to add more capabilities.
This allowed us to create ip routes and experiment with the zeebe deployment distribution. During this I have read the <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="noopener noreferrer">capabilities list of linux</a>, and found out that we can mark files as immutable, which might be interesting for a chaos experiment.</p><p>In this chaos day I planned to find out how marking a file immutable affects our brokers and I made the hypothesis that: <em>If a leader has a write error, which is not recoverable, it will step down and another leader should take over.</em> I put this in our hypothesis backlog (<a href="https://github.com/zeebe-io/zeebe-chaos/issues/52" target="_blank" rel="noopener noreferrer">zeebe-chaos#52</a>). </p><p>In order to really run this kind of experiment I need to find out whether marking a file immutable will cause any problems and if not how I can cause write errors such that affects the broker.
Unfortunately it turned out that immutable files will not cause issues on already opened file channels, but I found some other bugs/issues, which you can read below.</p><p>In the next chaos days I will search for a way to cause write errors proactively, so we can verify that our system can handle such issues.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="immutable-file">Immutable File<a href="#immutable-file" class="hash-link" aria-label="Direct link to Immutable File" title="Direct link to Immutable File">â€‹</a></h3><p>In order to <a href="https://delightlylinux.wordpress.com/2012/12/11/file-immutable-attribute/" target="_blank" rel="noopener noreferrer">mark a file as immutable</a> we can use the command <code>chattr +i</code>. For that we need a specific capability called <code>LINUX_IMMUTABLE</code>. Since we were at this time not able to create new clusters I tested it with the helm charts, where it is anyway easier to give us these capabilities.</p><p>We just need to add in our <em>values</em> files the following:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">podSecurityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capabilities:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LINUX_IMMUTABLE&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since we want to experiment with leaders I need to get the current topology from the gateway, here I found an issue on our latest zbctl build and the human output (<a href="https://github.com/camunda-cloud/zeebe/issues/6692" target="_blank" rel="noopener noreferrer">camunda-cloud/zeebe#6692</a>). This is already fixed, thanks to <a href="https://github.com/MiguelPires" target="_blank" rel="noopener noreferrer">Miguel</a> ðŸš€!</p><p>After finding the correct leader we can execute on the corresponding broker/pod following commands to mark a file as immutable.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell ns:zell-chaos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ k </span><span class="token builtin class-name">exec</span><span class="token plain"> -it zell-chaos-zeebe-1 -- </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># opens an interactive shell on zell-chaos-zeebe-1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-chaos-zeebe-1</span><span class="token comment" style="color:#999988;font-style:italic"># cd data/raft-partition/partitions/1/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-chaos-zeebe-1</span><span class="token comment" style="color:#999988;font-style:italic"># chattr +i raft-partition-partition-1-1.log # marks the log file immutable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-chaos-zeebe-1</span><span class="token comment" style="color:#999988;font-style:italic"># lsattr raft-partition-partition-1-1.log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----i---------e---- raft-partition-partition-1-1.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the last command <code>lsattr</code> we print out the file attributes, where we see that the immutable flag is set (the <code>i</code> in the output).
After setting the log file to immutable nothing really happens. I checked again the manual page and read that this not affects already created file channels.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CHATTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                           General Commands Manual                          CHATTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       chattr - change </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> attributes on a Linux </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      i      A  </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> with the </span><span class="token string" style="color:#e3116c">&#x27;i&#x27;</span><span class="token plain"> attribute cannot be modified: it cannot be deleted or renamed, no </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> can be created to this file, </span><span class="token function" style="color:#d73a49">most</span><span class="token plain"> of the </span><span class="token function" style="color:#d73a49">file</span><span class="token string" style="color:#e3116c">&#x27;s metadata can not be modified, and the</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              file can not be opened in write mode.  Only the superuser or a process possessing the CAP_LINUX_IMMUTABLE capability can set or clear this attribute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      BUGS AND LIMITATIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       The &#x27;</span><span class="token plain">c</span><span class="token string" style="color:#e3116c">&#x27;, &#x27;</span><span class="token plain">s</span><span class="token string" style="color:#e3116c">&#x27;,  and &#x27;</span><span class="token plain">u</span><span class="token string" style="color:#e3116c">&#x27; attributes are not honored by the ext2, ext3, and ext4 filesystems as implemented in the current mainline Linux kernels.  Setting &#x27;</span><span class="token plain">a</span><span class="token string" style="color:#e3116c">&#x27; and &#x27;</span><span class="token plain">i&#x27; attributes will not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       affect the ability to </span><span class="token function" style="color:#d73a49">write</span><span class="token plain"> to already existing </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> descriptors.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we actually are not able to use it to cause any write errors on a running leader, but interesting was what happened later when the pod was restarted. The pod was not able to restart, since the log was still immutable. We can see the following bootstrap sequence and the related errors:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.433467Z Found segment: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">raft-partition-partition-2-1.log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.499079Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Transitioning to FOLLOWER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.500847Z RaftPartitionServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Starting server </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> partition PartitionId</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">group</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raft-partition</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.506876Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Server </span><span class="token function" style="color:#d73a49">join</span><span class="token plain"> completed. Waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the server to be READY </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.508400Z Bootstrap Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token plain">/13</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: cluster services failed with unexpected exception. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.523239Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: subscription api </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.525497Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: subscription api closed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.526484Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token builtin class-name">command</span><span class="token plain"> api handler </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.528108Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token builtin class-name">command</span><span class="token plain"> api handler closed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:02.528740Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token builtin class-name">command</span><span class="token plain"> api transport </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:03.519309Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Found leader </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:03.521376Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Setting firstCommitIndex to </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">. RaftServer is ready only after it has committed events upto this index </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:03.522206Z RaftPartitionServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Successfully started server </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> partition PartitionId</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">group</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">raft-partition</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> 1171ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.553825Z Stopped </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.555166Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token builtin class-name">command</span><span class="token plain"> api transport closed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2026</span><span class="token plain"> ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.556177Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: membership and replication protocol </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.558282Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - Transitioning to INACTIVE </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.558408Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: membership and replication protocol failed to close. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.560776Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: actor scheduler </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.561558Z Closing actor thread ground </span><span class="token string" style="color:#e3116c">&#x27;Broker-1-zb-fs-workers&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.563600Z Closing segment: JournalSegment</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">index</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.563881Z Closing actor thread ground </span><span class="token string" style="color:#e3116c">&#x27;Broker-1-zb-fs-workers&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> closed successfully </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.564448Z Closing actor thread ground </span><span class="token string" style="color:#e3116c">&#x27;Broker-1-zb-actors&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.566157Z Closing actor thread ground </span><span class="token string" style="color:#e3116c">&#x27;Broker-1-zb-actors&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> closed successfully </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.567716Z Closing Broker-1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: actor scheduler closed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.568366Z Closing Broker-1 succeeded. Closed </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> steps </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2045</span><span class="token plain"> ms. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.568908Z Failed to start broker </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.574482Z </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error starting ApplicationContext. To display the conditions report re-run your application with </span><span class="token string" style="color:#e3116c">&#x27;debug&#x27;</span><span class="token plain"> enabled. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.595919Z Application run failed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:04.627321Z Shutting down ExecutorService </span><span class="token string" style="color:#e3116c">&#x27;applicationTaskExecutor&#x27;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following exception occurred on opening the log:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java.util.concurrent.CompletionException: io.zeebe.journal.JournalException: java.nio.file.FileSystemException: /usr/local/zeebe/data/raft-partition/partitions/1/raft-partition-partition-1-1.log: Operation not permitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.CompletableFuture.encodeThrowable(Unknown Source) ~[?:?]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.CompletableFuture.completeThrowable(Unknown Source) ~[?:?]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Thread.run(Unknown Source) ~[?:?]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: io.zeebe.journal.JournalException: java.nio.file.FileSystemException: /usr/local/zeebe/data/raft-partition/partitions/1/raft-partition-partition-1-1.log: Operation not permitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.zeebe.journal.file.SegmentedJournal.openChannel(SegmentedJournal.java:468) ~[zeebe-journal-1.0.0-SNAPSHOT.jar:1.0.0-SNAPSHOT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.zeebe.journal.file.SegmentedJournal.loadSegments(SegmentedJournal.java:490) ~[zeebe-journal-1.0.0-SNAPSHOT.jar:1.0.0-SNAPSHOT]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After this exception on bootstrap the broker tries to close itself, and we see an error on closing a step <code>2021-03-30 11:11:04.558 CEST Closing Broker-1 [4/5]: membership and replication protocol failed to close.</code> This seems to be caused by a NPE.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java.lang.NullPointerException: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.atomix.raft.partition.impl.RaftPartitionServer.stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RaftPartitionServer.java:141</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ~</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">atomix-cluster-1.0.0-SNAPSHOT.jar:1.0.0-SNAPSHOT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.atomix.raft.partition.RaftPartition.closeServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RaftPartition.java:165</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ~</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">atomix-cluster-1.0.0-SNAPSHOT.jar:1.0.0-SNAPSHOT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.atomix.raft.partition.RaftPartition.close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RaftPartition.java:155</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ~</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">atomix-cluster-1.0.0-SNAPSHOT.jar:1.0.0-SNAPSHOT</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The problem now here is that the broker never comes back. It is not restarted, which is a bit confusing. Furthermore it hasn&#x27;t retried on opening, which is also unexpected, since it might be a temporary exception. </p><p>We can see in stackdriver that the new leader is not able to connect, which is expected. But we also see that the other Broker never comes back which is unexpected!</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:05.006825Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - AppendRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">term</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">leader</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogTerm</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">entries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">commitIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> failed: java.util.concurrent.CompletionException: io.atomix.cluster.messaging.MessagingException</span><span class="token variable" style="color:#36acaa">$NoRemoteHandler</span><span class="token builtin class-name">:</span><span class="token plain"> No remote message handler registered </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:05.256830Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - AppendRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">term</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">leader</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogTerm</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">entries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">commitIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> failed: java.util.concurrent.CompletionException: io.atomix.cluster.messaging.MessagingException</span><span class="token variable" style="color:#36acaa">$NoRemoteHandler</span><span class="token builtin class-name">:</span><span class="token plain"> No remote message handler registered </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:08.450683Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - AppendRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">term</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">leader</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogTerm</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">entries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">commitIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> failed: java.util.concurrent.CompletionException: io.atomix.cluster.messaging.MessagingException</span><span class="token variable" style="color:#36acaa">$NoRemoteHandler</span><span class="token builtin class-name">:</span><span class="token plain"> No remote message handler registered </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:12.897492Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - AppendRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">term</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">leader</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogTerm</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">entries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">commitIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> failed: java.util.concurrent.CompletionException: io.atomix.cluster.messaging.MessagingException</span><span class="token variable" style="color:#36acaa">$NoRemoteHandler</span><span class="token builtin class-name">:</span><span class="token plain"> No remote message handler registered </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this message </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain">-03-30T09:11:25.950363Z RaftServer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">raft-partition-partition-3</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> - AppendRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">term</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">leader</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">prevLogTerm</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">entries</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">commitIndex</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> failed: java.util.concurrent.CompletionException: io.atomix.cluster.messaging.MessagingException</span><span class="token variable" style="color:#36acaa">$NoRemoteHandler</span><span class="token builtin class-name">:</span><span class="token plain"> No remote message handler registered </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this message</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We need to investigate this issue <a href="https://github.com/camunda-cloud/zeebe/issues/6702" target="_blank" rel="noopener noreferrer">camunda-cloud/zeebe#6702</a> further, and I need to find out how we can cause write errors proactively.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="found-bugs">Found Bugs<a href="#found-bugs" class="hash-link" aria-label="Direct link to Found Bugs" title="Direct link to Found Bugs">â€‹</a></h4><ul><li>Int Console was not able to create new clusters in ultrachaos </li><li>Zbctl human output looks broken <a href="https://github.com/camunda-cloud/zeebe/issues/6692" target="_blank" rel="noopener noreferrer">#6692</a></li><li>Broker is not correctly shutdown <a href="https://github.com/camunda-cloud/zeebe/issues/6702" target="_blank" rel="noopener noreferrer">#6702</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2021-03-30-set-file-immutable/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">BPMN meets Chaos Engineering</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Camunda Cloud network partition</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#immutable-file" class="table-of-contents__link toc-highlight">Immutable File</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.cf57c9dd.js"></script>
<script src="/zeebe-chaos/assets/js/main.b7fadd9c.js"></script>
</body>
</html>